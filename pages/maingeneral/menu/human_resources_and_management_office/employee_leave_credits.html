<style>
#table_employee_leave_credits_FFQ999 thead {
  position: sticky;
  top: 80px;        /* height ng navbar (adjust kung mas mataas) */
  z-index: 3;
  background: #fff;
}


</style>

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">Eastern Samar</a></li>
    <li class="breadcrumb-item active" aria-current="page">Human Resources and Management Office</li>
    <li class="breadcrumb-item active" aria-current="page">Leave Credits</li>
  </ol>
</nav>

<div class="card">
  <div class="card-header">
    <div class="row">
      <div class="col-md-3">
        <label for="select_employee_leave_credits_employee_id">Employee ID</label>
        <input type="text" id="select_employee_leave_credits_employee_id" class="form-control" placeholder="Employee ID">
      </div>
      <div class="col-md-3">
        <label for="select_employee_leave_credits_year">Year</label>
        <select class="form-select" id="select_employee_leave_credits_year">
          <option value="" selected>--SELECT--</option>
          <option value="ALL">ALL YEAR</option>
          <option value="2026">2026</option>
          <option value="2025">2025</option>
          <option value="2024">2024</option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="select_employee_leave_credits_month">Month</label>
        <select class="form-select" id="select_employee_leave_credits_month">
          <option value="" selected>--SELECT--</option>
          <option value="ALL">ALL MONTH</option>
          <option value="1">JAN</option>
          <option value="2">FEB</option>
          <option value="3">MAR</option>
          <option value="4">APR</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button id="btn_load_leave_credits" class="btn btn-primary w-100">Load Leave Credits</button>
      </div>
    </div>
  </div>

  <div class="card-body">
    

<table id="table_employee_leave_credits_FFQ999" class="table-bordered table-striped table-hovered text-nowrap">
  <thead class="table-primary">
    <tr>
      <th class="text-center" rowspan="3">Date <br> (YYYY-MM-DD) </th>
      <th class="text-center" rowspan="3">-</th>
      <th class="text-center bg-warning text-white" colspan="9">DAILY TIME RECORD (DTR)</th>
      <th class="text-center">-</th>
      <th class="text-center bg-success text-white" colspan="3">SALARY</th>
      <th class="text-center" colspan="4">LEAVE CREDITS</th>
    </tr>
    <tr>

      <th class="text-center" colspan="3">AM</th>
      <th class="text-center" colspan="3">PM</th>
      <th class="text-center">TOTAL</th>
      <th class="text-center" colspan="2">UNDERTIME</th> 
      <th class="text-center" rowspan="2">Status</th>
      <th class="text-center" rowspan="2">Daily rate <br> of pay</th>
      <th class="text-center" rowspan="2">Amount <br> Deducted</th>
      <th class="text-center" rowspan="2">Net <br> Balance</th>

      <th class="text-center" colspan="2">Leave without pay</th>
      <th class="text-center" colspan="2">Leave with pay </th>


    </tr>
    <tr>
      <th>Arrival</th>
      <th>Departure</th>
      <th>Total</th>
      <th>Arrival</th>
      <th>Departure</th>
      <th>Total</th>
      <th>AM & PM</th>
      <th>Hours</th> 
      <th>Minutes</th> 
      <th>VL</th>
      <th>SL</th>
      <th>VL</th>
      <th>SL</th>
    </tr>
  </thead>
  <tfoot class="table-secondary text-danger">
    <tr>
      <th colspan="8" style="text-align:right">TOTAL:</th>
      <th id="total_am_pm_x"></th>
      <th id="total_undertime_hours"></th>
      <th id="total_undertime_minutes"></th>
      <th></th>
      <th colspan="7"></th>
    </tr>
  </tfoot>
  <tbody></tbody>
</table>

  </div>
</div>




<script>
$(document).ready(function() {
  let table = $('#table_employee_leave_credits_FFQ999').DataTable({
    serverSide: true,
    processing: true,
    ajax: {
      url: APP_API_ENDPOINT + '/api/employee-leave-daily',
      type: 'POST',
      data: function(d) {
        d.employee_id = $('#select_employee_leave_credits_employee_id').val();
        d.year = $('#select_employee_leave_credits_year').val();
        d.month = $('#select_employee_leave_credits_month').val();
      },
      dataSrc: function(json) {
        // Use backend totals for footer
        if (json.totals) {
          $('#total_am_pm_x').html(json.totals.am_pm_total);
          $('#total_undertime_hours').html(json.totals.undertime_hours);
          $('#total_undertime_minutes').html(json.totals.undertime_minutes);
        }
        return json.data;
      }
    },
    columns: [
      { 
        data: null,
        render: function (data, type, row) {
          return row.date + ' | ' + row.weekday_status;
        }
      },
      { 
        data: 'weekend_status',
        render: function(data, type, row) {
          return row.weekend_status === 'WEEKEND'
                 ? `<span class="text-danger">${row.weekend_status}</span>`
                 : '';
        }
      },
      { data: 'am_login' },
      { data: 'am_logout' },
      { data: 'am_total_login_and_logout_hrs_and_minutes'},
      { data: 'pm_login' },
      { data: 'pm_logout' },
      { data: 'pm_total_login_and_logout_hrs_and_minutes'},
      { data: 'am_pm_total_hours_and_minutes' },

      { data: 'undertime_hours' },
      { data: 'undertime_minutes' },
      { data: 'status_application' }, // example for application for leave cause it has 4hrs above late, and no penalty etc

      { data: 'dailyratepay' },
      { data: 'dailyratepay_deducted' },
      { data: 'dailyratepay' },
      { data: 'dailyratepay' },
      { data: 'dailyratepay' },
      { data: 'dailyratepay' },
      { data: 'dailyratepay' },

    ],
    pageLength: 31,
    lengthMenu: [31, 50, 100]
  });

  $('#btn_load_leave_credits').on('click', function() {
    table.ajax.reload();
  });
});
</script>
